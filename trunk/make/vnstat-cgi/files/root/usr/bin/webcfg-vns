#!/bin/sh

export PATH=/sbin:/bin:/usr/sbin:/usr/bin:/mod/sbin:/mod/bin:/mod/usr/sbin:/mod/usr/bin
export LD_LIBRARY_PATH=/mod/lib

DAEMON=vnstat-cgi
SUBDAEMON=vns

if [ ! -r "/mod/etc/conf/vnstat.cfg" ]; then
	echo "Error[$DAEMON]: not configured" 1>&2
	exit 1
fi

. /mod/etc/conf/vnstat.cfg

homedir=/mod/pkg/vnstat/usr/mww-$SUBDAEMON/

if [ "$VNSTAT_WEB_AUTH" = yes ]; then
	echo "/:$VNSTAT_WEB_USER:$(httpd -m $VNSTAT_WEB_PASS)" > /mod/etc/httpd-$SUBDAEMON.conf
	VNS_CONF="-c /mod/etc/httpd-$SUBDAEMON.conf"
fi
		
exec httpd "$@" -p "$VNSTAT_WEB_PORT" $VNS_CONF -h "$homedir" -r "vnstat"
