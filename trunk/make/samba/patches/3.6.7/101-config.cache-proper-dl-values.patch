--- source3/configure
+++ source3/configure
@@ -11036,7 +11036,11 @@
 
 for ac_func in dlopen dlsym dlerror dlclose
 do :
+  if test "${ac_cv_search_dlopen}" = "-ldl"; then
+  as_ac_var=`$as_echo "ac_cv_lib_dl_$ac_func" | $as_tr_sh`
+  else
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+  fi
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
 eval as_val=\$$as_ac_var
    if test "x$as_val" = x""yes; then :
