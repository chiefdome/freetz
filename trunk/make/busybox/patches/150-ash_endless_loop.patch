--- shell/ash.c	2007/04/14 10:09:57	18436
+++ shell/ash.c	2007/04/28 22:39:02	18530
@@ -3500,7 +3500,9 @@
 		/* turning job control off */
 		fd = ttyfd;
 		pgrp = initialpgrp;
-		xtcsetpgrp(fd, pgrp);
+		/* was xtcsetpgrp, but this can make exiting ash
+		 * with pty already deleted loop forever */
+		tcsetpgrp(fd, pgrp);
 		setpgid(0, pgrp);
 		setsignal(SIGTSTP);
 		setsignal(SIGTTOU);
