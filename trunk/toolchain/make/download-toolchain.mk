include $(TOOLCHAIN_DIR)/make/kernel/ccache/ccache.mk
include $(TOOLCHAIN_DIR)/make/target/ccache/ccache.mk
include $(TOOLCHAIN_DIR)/make/target/libtool-host/libtool-host.mk
include $(TOOLCHAIN_DIR)/make/target/uclibc/uclibc.mk

ifeq ($(strip $(FREETZ_TOOLCHAIN_CCACHE)),y)
	CCACHE:=ccache-kernel ccache
endif

KERNEL_TOOLCHAIN_ID:=$(TARGET_ARCH)_$(KERNEL_TOOLCHAIN_GCC_VERSION)

KERNEL_TOOLCHAIN_MD5_mipsel_3.4.6:=6b4bea759a111f39821310d82702099b
KERNEL_TOOLCHAIN_MD5_mips_4.4.7:=903e1dc96578776fcfb009c83c1395fb
KERNEL_TOOLCHAIN_MD5_mipsel_4.4.7:=f56fee0d50c1dbbb64e54692a1715223
KERNEL_TOOLCHAIN_MD5:=$(KERNEL_TOOLCHAIN_MD5_$(KERNEL_TOOLCHAIN_ID))

KERNEL_TOOLCHAIN_VERSION_mipsel_3.4.6:=r8342
KERNEL_TOOLCHAIN_VERSION:=$(or $(KERNEL_TOOLCHAIN_VERSION_$(KERNEL_TOOLCHAIN_ID)),r8800)
KERNEL_TOOLCHAIN_SOURCE:=$(TARGET_ARCH)_gcc-$(KERNEL_TOOLCHAIN_GCC_VERSION)-freetz-$(KERNEL_TOOLCHAIN_VERSION)-shared-glibc.tar.lzma

TARGET_TOOLCHAIN_ID:=$(TARGET_ARCH)_$(TARGET_TOOLCHAIN_GCC_VERSION)_$(TARGET_TOOLCHAIN_UCLIBC_VERSION)

# 4.5
TARGET_TOOLCHAIN_MD5_mipsel_4.5.3_0.9.28:=a7c5d1f9c30d14416564267c2572e054
TARGET_TOOLCHAIN_MD5_mipsel_4.5.3_0.9.29:=8be1a291865a549cca9c81522c9b44e8
TARGET_TOOLCHAIN_MD5_mips_4.5.3_0.9.30.3:=4a3ae57cb6e9c826d66e9d79b2a7fca8
TARGET_TOOLCHAIN_MD5_mips_4.5.3_0.9.31.1:=c68545d9ec6ee419720dacce4092ae20
TARGET_TOOLCHAIN_MD5_mipsel_4.5.3_0.9.31.1:=55124c826e2a187c886fdc3585711795
TARGET_TOOLCHAIN_MD5_mips_4.5.3_0.9.32.1:=e40834c638bea7b019251fd0b82f396a
TARGET_TOOLCHAIN_MD5_mipsel_4.5.3_0.9.32.1:=d2347262e4ee79ae09d7cc6f55e7cc6c
# 4.6
TARGET_TOOLCHAIN_MD5_mipsel_4.6.3_0.9.28:=a0f7b4a36b21cf9ed3fb9f6750b2a572
TARGET_TOOLCHAIN_MD5_mipsel_4.6.3_0.9.29:=f1f60d71238ea95540f22d8fe3e2fb92
TARGET_TOOLCHAIN_MD5_mips_4.6.3_0.9.30.3:=8a5046bd2b3beabc4ae840641b04ff24
TARGET_TOOLCHAIN_MD5_mips_4.6.3_0.9.31.1:=012eeb24ade8b6490bbe9aaea104355c
TARGET_TOOLCHAIN_MD5_mipsel_4.6.3_0.9.31.1:=905c83f06ad4520b9fbd43508d30ccce
TARGET_TOOLCHAIN_MD5_mips_4.6.3_0.9.32.1:=117ced66f0eb42b5abe63894f6bbac74
TARGET_TOOLCHAIN_MD5_mipsel_4.6.3_0.9.32.1:=b2249b26e7f843c813bf356b113d4aa8
TARGET_TOOLCHAIN_MD5:=$(TARGET_TOOLCHAIN_MD5_$(TARGET_TOOLCHAIN_ID))

TARGET_TOOLCHAIN_VERSION_mips_4.5.3_0.9.32.1:=r8424
TARGET_TOOLCHAIN_VERSION_mipsel_4.5.3_0.9.32.1:=r8424
TARGET_TOOLCHAIN_VERSION:=$(or $(TARGET_TOOLCHAIN_VERSION_$(TARGET_TOOLCHAIN_ID)),$(if $(FREETZ_TARGET_COMPILER_GCC_4_6),r8743,r8367))
TARGET_TOOLCHAIN_SOURCE:=$(TARGET_ARCH)_gcc-$(TARGET_TOOLCHAIN_GCC_VERSION)_uClibc-$(TARGET_TOOLCHAIN_UCLIBC_VERSION)-freetz-$(TARGET_TOOLCHAIN_VERSION)-shared-glibc.tar.lzma

$(KERNEL_TOOLCHAIN_DIR):
	@mkdir -p $@

$(TARGET_TOOLCHAIN_DIR):
	@mkdir -p $@

$(DL_DIR)/$(KERNEL_TOOLCHAIN_SOURCE): | $(DL_DIR)
	@$(DL_TOOL) $(DL_DIR) $(KERNEL_TOOLCHAIN_SOURCE) "" $(KERNEL_TOOLCHAIN_MD5)

$(DL_DIR)/$(TARGET_TOOLCHAIN_SOURCE): | $(DL_DIR)
	@$(DL_TOOL) $(DL_DIR) $(TARGET_TOOLCHAIN_SOURCE) "" $(TARGET_TOOLCHAIN_MD5)

download-toolchain: $(KERNEL_CROSS_COMPILER) kernel-configured \
			$(TARGET_CROSS_COMPILER) target-toolchain-kernel-headers \
			$(TARGET_SPECIFIC_ROOT_DIR)/lib/libc.so.0 \
			$(CCACHE) $(STDCXXLIB) $(TARGET_CXX_CROSS_COMPILER_SYMLINK_TIMESTAMP) libtool-host $(if $(FREETZ_PACKAGE_GDB_HOST),gdbhost)

gcc-kernel: $(KERNEL_CROSS_COMPILER)
$(KERNEL_CROSS_COMPILER): $(DL_DIR)/$(KERNEL_TOOLCHAIN_SOURCE) | \
		$(KERNEL_TOOLCHAIN_SYMLINK_DOT_FILE) $(TOOLS_DIR)/busybox
	mkdir -p $(TOOLCHAIN_DIR)/build
	$(RM) -r $(TOOLCHAIN_BUILD_DIR)/$(KERNEL_TOOLCHAIN_COMPILER)
	$(TOOLS_DIR)/busybox tar $(VERBOSE) -xf $(DL_DIR)/$(KERNEL_TOOLCHAIN_SOURCE) -C $(TOOLCHAIN_DIR)/build
	@touch $@

gcc: $(TARGET_CROSS_COMPILER)
$(TARGET_CROSS_COMPILER): $(DL_DIR)/$(TARGET_TOOLCHAIN_SOURCE) | \
		$(TARGET_TOOLCHAIN_SYMLINK_DOT_FILE) $(TOOLS_DIR)/busybox
	mkdir -p $(TOOLCHAIN_DIR)/build
	$(RM) -r $(TOOLCHAIN_BUILD_DIR)/$(TARGET_TOOLCHAIN_COMPILER)
	$(TOOLS_DIR)/busybox tar $(VERBOSE) -xf $(DL_DIR)/$(TARGET_TOOLCHAIN_SOURCE) -C $(TOOLCHAIN_DIR)/build
	@touch $@

download-toolchain-clean:

download-toolchain-dirclean: kernel-toolchain-dirclean target-toolchain-dirclean

download-toolchain-distclean: kernel-toolchain-distclean target-toolchain-distclean

kernel-toolchain-dirclean:

target-toolchain-dirclean:

.PHONY: gcc-kernel gcc
