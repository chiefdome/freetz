-include $(TOOLCHAIN_DIR)/make/kernel/*/Makefile.in
-include $(TOOLCHAIN_DIR)/make/target/*/Makefile.in

REAL_GNU_KERNEL_NAME:=mipsel-unknown-linux-gnu

KERNEL_TOOLCHAIN_GCC_VERSION:=$(strip $(subst ",, $(FREETZ_KERNEL_GCC_VERSION)))
KERNEL_TOOLCHAIN_BINUTILS_VERSION:=$(strip $(subst ",, $(FREETZ_KERNEL_BINUTILS_VERSION)))
KERNEL_TOOLCHAIN_DIR:=$(FREETZ_BASE_DIR)/$(SOURCE_DIR)/toolchain/kernel
KERNEL_TOOLCHAIN_SYMLINK:=$(FREETZ_BASE_DIR)/$(TOOLCHAIN_DIR)/kernel
KERNEL_TOOLCHAIN_SYMLINK_DOT_FILE:=$(FREETZ_BASE_DIR)/$(TOOLCHAIN_DIR)/.kernel
KERNEL_TOOLCHAIN_COMPILER:=gcc-$(KERNEL_TOOLCHAIN_GCC_VERSION)
KERNEL_TOOLCHAIN_STAGING_DIR:=$(FREETZ_BASE_DIR)/$(TOOLCHAIN_BUILD_DIR)/$(KERNEL_TOOLCHAIN_COMPILER)/$(REAL_GNU_KERNEL_NAME)

KERNEL_TOOLCHAIN_PATH:=$(KERNEL_TOOLCHAIN_STAGING_DIR)/bin:/bin:/sbin:/usr/bin:/usr/sbin

TARGET_TOOLCHAIN_GCC_VERSION:=$(strip $(subst ",, $(FREETZ_TARGET_GCC_VERSION)))
TARGET_TOOLCHAIN_UCLIBC_VERSION:=$(strip $(subst ",, $(FREETZ_TARGET_UCLIBC_VERSION)))
TARGET_TOOLCHAIN_BINUTILS_VERSION:=$(strip $(subst ",, $(FREETZ_TARGET_BINUTILS_VERSION)))

TARGET_TOOLCHAIN_UCLIBC_REF:=$(strip $(subst ",, $(FREETZ_TARGET_UCLIBC_REF)))

TARGET_TOOLCHAIN_SYMLINK:=$(FREETZ_BASE_DIR)/$(TOOLCHAIN_DIR)/target
TARGET_TOOLCHAIN_SYMLINK_DOT_FILE:=$(FREETZ_BASE_DIR)/$(TOOLCHAIN_DIR)/.target
TARGET_TOOLCHAIN_COMPILER:=gcc-$(TARGET_TOOLCHAIN_GCC_VERSION)-uClibc-$(TARGET_TOOLCHAIN_UCLIBC_VERSION)
TARGET_TOOLCHAIN_DIR:=$(FREETZ_BASE_DIR)/$(SOURCE_DIR)/toolchain/target/$(TARGET_TOOLCHAIN_COMPILER)
TARGET_TOOLCHAIN_STAGING_DIR:=$(FREETZ_BASE_DIR)/$(TOOLCHAIN_BUILD_DIR)/$(TARGET_TOOLCHAIN_COMPILER)/$(REAL_GNU_TARGET_NAME)
TARGET_UTILS_DIR:=$(TARGET_TOOLCHAIN_STAGING_DIR)/target-utils

TARGET_TOOLCHAIN_GDB_VERSION:=$(strip $(subst ",, $(FREETZ_GDB_VERSION)))

$(KERNEL_TOOLCHAIN_SYMLINK_DOT_FILE): $(TOPDIR)/.config
	@$(RM) $(KERNEL_TOOLCHAIN_SYMLINK)
	@ln -fs $(BUILD_DIR)/$(KERNEL_TOOLCHAIN_COMPILER)/$(REAL_GNU_KERNEL_NAME) $(KERNEL_TOOLCHAIN_SYMLINK)
	@touch $@

$(TARGET_TOOLCHAIN_SYMLINK_DOT_FILE): $(TOPDIR)/.config
	@$(RM) $(TARGET_TOOLCHAIN_SYMLINK)
	@ln -fs $(BUILD_DIR)/$(TARGET_TOOLCHAIN_COMPILER)/$(REAL_GNU_TARGET_NAME) $(TARGET_TOOLCHAIN_SYMLINK)
	@touch $@

ifeq ($(strip $(FREETZ_BUILD_TOOLCHAIN)),y)
TOOLCHAIN+=kernel-toolchain
TOOLCHAIN+=target-toolchain
else
TOOLCHAIN:=download-toolchain
endif
